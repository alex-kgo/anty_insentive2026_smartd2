# 로지 스마트D2 자동 취합 시스템 개발 진행 현황 (2026-02-20)

본 문서는 로지 스마트D2(SmartD2) 프로그램에서 인센티브 정산 데이터를 자동으로 추출하여 구글 스프레드시트에 업로드하고 텔레그램으로 보고하는 시스템의 현재 개발 상태를 정리한 것입니다.

## 1. 프로젝트 개요
- **목적**: 매월/매일 반복되는 로지 호출 데이터 정산을 자동화하여 업무 효율성 증대.
- **주요 흐름**: 로지 프로그램 접속(수동) -> 기간별 조회 -> 엑셀 출력 -> 데이터 가공 -> 구글 시트 저장 -> 텔레그램 보고.

## 2. 현재 완료된 사항 (Current Status)

### ✅ 통합 GUI 제어 센터 고도화 (`gui_main.py`)
- **월간 네비게이션 추가**: `<` , `>` 버튼을 통해 한 달 단위로 정산월을 간편하게 이동하는 기능 추가.
- **정산 주기 자동화**: 매월 21일부터 다음 달 20일까지의 정산 범위를 기본값으로 자동 설정.
- **다이나믹 날짜 표시**: 오늘/어제/7일/기간 지정 모드 선택 시 실제 처리될 날짜 범위를 하단에 즉시 미리보기로 표시.
- **실시간 한국어 로그**: 모든 자동화 동작 과정을 GUI 창 안에서 한국어로 실시간 확인 가능.
- **작업 중지 기능**: 안전한 중지 버튼을 통해 현재 처리 중인 날짜까지만 마무리하고 멈출 수 있는 기능 구현.

### ✅ 로지 자동화 및 데이터 가공 (`logi_automation.py`, `excel_handler.py`)
- **불필요 데이터 필터링**: 성명 필드에 "합계"가 포함된 행(소계 등)을 자동으로 제외하여 실제 기사 데이터만 추출.
- **합계 데이터 유지**: 수신/발신 합계뿐만 아니라 '총합계' 컬럼을 활성화하여 구글 시트 및 결과 파일에 포함.
- **좌표 기반 정밀 제어**: `config.py` 설정을 통한 날짜 입력 및 버튼 클릭 안정화.

### ✅ 보고 및 저장 체계 강화 (`google_sheet_manager.py`, `telegram_bot.py`)
- **시트명 가독성 개선**: 구글 시트 탭 이름을 `시작일-종료일` (예: 20260121-20260220) 형식으로 설정하여 기간별 관리 용이성 증대.
- **텔레그램 리포트 고도화**: 작업 완료 보고 시 해당 **구글 스프레드시트의 바로가기 링크**를 포함하여 즉시 확인 가능하도록 개선.
- **구글 시트 Upsert**: 동일 날짜/코드 데이터가 있을 경우 합산이 아닌 **최신 데이터로 갱신(Overwrite)** 하여 데이터 정확성 보장.

## 3. 파일별 역할 안내
- `main.py`: 프로그램 실행 진입점 (GUI 실행).
- `gui_main.py`: 메인 UI 및 자동화 제어 핵심 로직.
- `logi_automation.py`: 로지 창 연결 및 UI 조작 담당.
- `excel_handler.py`: 로지가 생성한 엑셀 파일 연결 및 데이터 추출.
- `google_sheet_manager.py`: 구글 스프레드시트 API 연동 및 데이터 저장.
- `telegram_bot.py`: 텔레그램 알림 메시지 및 파일 전송.
- `config.py`: 프로그램 주요 좌표, 경로, 설정값 관리.
- `.env`: API 키, 텔레그램 토큰, 파일 경로 등 민감 정보 저장.

## 4. 다음에 이어갈 작업 (Next Steps)
- **좌표 정밀 보정**: 로지 프로그램의 창 크기나 윈도우 스케일링에 따른 좌표 미세 조정 확인 필요.
- **예외 상황 처리**: 조회 결과가 없거나 로지 프로그램 내 예상치 못한 팝업 발생 시 처리 루틴 강화.
- **데이터 분석 고도화**: 추출된 데이터를 기반으로 특정 기사님이나 고객사별 통계 기능 추가 검토.

---
**실행 방법**: 로지 프로그램 로그인 완료 후 `python .\main.py` 실행
